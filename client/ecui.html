<!doctype html>
<html>

<head>
    <title>ECUI - Test Stand</title>
    <link rel="stylesheet" href="lib/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="lib/core.js"></script>
    <script src="lib/charts.js"></script>
    <script src="lib/material.js"></script>
    <script src="lib/animated.js"></script>
    <link href="css/styles.css" rel="stylesheet">
    </link>

    <link id="theme" rel="stylesheet" type="text/css" href="">
    <link rel="stylesheet" type="text/css" href="pnid_houbolt/client/css/pnid.css">
    <link rel="stylesheet" type="text/css" href="pnid_houbolt/client/css/bootstrapOverride.css">

    <link rel="stylesheet" href="pnid_houbolt/client/css/logBox.css">
    <link rel="stylesheet" href="pnid_houbolt/client/css/popup.css">
    <link rel="stylesheet" href="pnid_houbolt/client/css/inputs.css">
    <link rel="stylesheet" href="pnid_houbolt/client/css/slider.css">
    <link rel="stylesheet" href="lib/icons/bootstrap-icons.css">
</head>

<body>
    <div id="disableAll"></div>
    <div id="templates" hidden>
        <div id="popupTemp" class="container-fluid popup">
            <div class="row popup-title control-row justify-content-end">
                <div class="col popup-heading">Temp Name</div>
                <button type="button" class="btn btn-outline-danger btn-close">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="popup-content">
            </div>
        </div>
        <div id="headerTemp" class="row control-row popup-row">
            <label class="popup-sub-header"></label>
        </div>
        <div id="separatorTemp" class="row control-row popup-row">
            <hr class="separator"></hr>
        </div>
        <div id="collapseWrapperTemp" class="row control-row popup-row">
            <button type="button" class="btn btn-outline-secondary">
                <i class="bi bi-eye-fill"></i>
            </button>
            <div class="popup-collapse-label">
            </div>
            <div class="popup-collapse-content">
            </div>
        </div>
        <div id="textDisplayTemp" class="row control-row popup-row">
            <a class="popup-value-out popup-label"></a>
            <label class="popup-value-out"></label>
            <label class="popup-value-suffix-out"></label>
        </div>
        <div id="externalDisplayTemp" class="row control-row popup-row externalContainer">
            <iframe src=""></iframe>
        </div>
        <div id="sliderTemp" class="row control-row popup-row">
            <div class="range-slider col">
                <label class="range-slider-label input-label">Temp Label</label><br>
                <input class="range-slider__range servo-slider manual-obj servo-enable-obj"
                    oninput="onServoSliderInput($(this));" type="range" value="40000" min="30000" max="55000" step="1">
                <span class="range-slider__value">0</span> 
                <div class="range-slider-caption">
                    <div class="range-slider-caption_left"> Closed </div>
                    <div class="range-slider-caption_right"> Open </div>
                </div>
            </div>
        </div>
        <div id="numberEntryTemp" class="row control-row popup-row">
            <div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%">
                <label class="popup-value-out"></label>
                <div style="display: flex; width: 60%; gap: 0.5em">
                    <input type="number" id="" min="" max="" class="form-control-sm"/>
                    <input type="button" onclick="" value="Set" class="btn btn-primary btn-sm"></input>
                </div>
            </div>
        </div>
        <div id="buttonEntryTemp" class="row control-row popup-row">
            <input type="button" onclick="" value="Name" class="btn btn-primary btn-sm"></input>
        </div>
        <div id="buttonDangerEntryTemp" class="row control-row popup-row">
            <input type="button" onclick="" value="Name" class="btn btn-danger btn-sm"></input>
        </div>
        <div id="digitalOutTemp" class="row control-row popup-row">
            <div class="form-control custom-control custom-checkbox">
                <input type="checkbox" class="custom-control-input ckbx manual-obj servo-enable-obj digitalOut" id="tempDigitalOut"
                    onclick="onDigitalCheck(this);">
                <label class="custom-control-label ckbx-label" for="tempDigitalOut">Temp Digital Out</label>
            </div>
        </div>
        <div id="logBoxTemp" class="logContainer">
            <div class="logTextArea" onwheel="disableAutoScroll()" style="display: none;">
                <div id="logEntryTemp" class="logEntry" style="display: none;"></div>
                <button type="button" class="btn btn-outline-primary scrollButton" onclick="activateAutoScroll()" style="display: none;">
                    <i class="bi bi-chevron-double-down"></i>
                </button>
            </div>
            <div class="logMenu">
                <button type="button" class="btn btn-primary" onclick="toggleLogBox()" disabled>
                    <i class="bi bi-arrow-up"></i>
                </button>
                <div class="logOverview">
                    <div id="logInfo" class="logCategory">
                        <span class="logCategoryNumber iconInfo">0</span>
                        <i class="bi bi-info-circle iconInfo"></i>
                    </div>
                    <div id="logWarning" class="logCategory">
                        <span class="logCategoryNumber iconWarning">0</span>
                        <i class="bi bi-exclamation-triangle iconWarning"></i>
                    </div>
                    <div id="logError" class="logCategory">
                        <span class="logCategoryNumber iconError">0</span>
                        <i class="bi bi-x-square iconError"></i>
                    </div>
                    <div id="logHardwareError" class="logCategory">
                        <span class="logCategoryNumber iconError">0</span>
                        <i class="bi bi-bug iconError"></i>
                    </div>
                </div>
            </div>
        </div>
        <div id="themeSwitcherTemp" class="themeSwitcher">
            <button type="button" class="btn btn-outline-secondary" onclick="switchTheme()">
                <i class="bi bi-moon"></i>
            </button>
        </div>
        
        <div id="tempCommandCategory" class="card">
            <div class="card-header">
                <h2 class="mb-0 w-100 h-100">
                    <button class="btn btn-link w-100 h-100 text-left" data-toggle="collapse" data-target="" aria-expanded="false" aria-controls="">
                        tempTitle
                    </button>
                </h2>
            </div>
            <div class="collapse" aria-labelledby="headingOne">
                <div class="card-body">
                </div>
            </div>
        </div>
        <div id="tempCommand">
            <li class="list-group-item">
                <div class="row command">
                    <label class="input-label col-2 command-label"
                        style="display: flex;align-items: center;">Command Template</label>
                        <div class="col"></div>
                    <div class="parameter-group col-auto">

                        <div class="input-group flex-nowrap" style="width: 18rem;">
                            <div class="input-group-prepend" >
                                <span class="input-group-text parameter-name">Parameter Template</span>
                            </div>
                            <input type="number" style="width: 2rem;" class="form-control parameter post-initialized-spinner" value="0.0" step="0.001" min="-2147483648" max="2147483647" data-decimals="3">
                        </div>
                        
                    </div>
                    <button class="col-auto float-right btn btn-secondary manual-obj" onclick="onCommandExecute(this);">Execute</button>
                </div>

            </li>
        </div>
        <div id="tempCommandCurrValue">
            <div class="parameter-group col-auto">

                <div class="input-group flex-nowrap" style="width: 18rem;">
                    <div class="input-group-prepend" >
                        <span class="input-group-text parameter-name">Current Value</span>
                    </div>
                    <input type="text" style="width: 2rem; height: auto !important" class="form-control text-center" value="0.0" data-command-state-name="temp">
                </div>
                
            </div>
        </div>
        <div id="pnidWarningTemp" class="pnid-global-warning warning-bar">
        <div id="server-script-template">
            <li class="list-group-item">
                <div class="row command">
                    <label class="input-label col-2 script-title"
                        style="display: flex;align-items: center;">Server Script Title</label>
                        <div class="col"></div>
                        <div class="parameter-group col-auto">

                            <div class="input-group flex-nowrap" style="width: 18rem;">
                                <div class="input-group-prepend" >
                                    <span class="input-group-text parameter-title">Parameter Template</span>
                                </div>
                                <input type="text" style="width: 2rem;" class="form-control parameter post-initialized-spinner">
                            </div>
                            
                        </div>
                    <button class="col-auto float-right btn btn-secondary manual-obj run-script-btn">Execute</button>
                </div>

            </li>
        </div>

    </div>


    <div id="titleBar" style="margin-bottom: -2rem;">
        <img id="icon" src="img/Space_Team_Logo_black.png" alt="ST Logo" style="width:7rem;margin-left: 1rem;">
        <p id="title">ECUI</p>
        <p id="subtitle"></p>
        <div class="navbarRightAlign">
            <span id="timer" class="timer">0.0</span>
        </div>
        <div style="margin-left: 1em" class="navbarRightAlign">
            <button class="btn btn-secondary m-auto titleBarButton" onclick="onPNIDInput('gui:FlushDatabase', 1, Date.now()*1000);">Flush Database</button>
        </div>
        <div style="margin-left: 1em" class="navbarRightAlign">
            <button class="btn btn-secondary m-auto titleBarButton" onclick="onInitValues(this);">Init Values</button>
        </div>
	<!-- <div style="margin-left: 1em" class="navbarRightAlign">
            <button class="btn btn-secondary m-auto titleBarButton" onclick="onRpiHalt(this);">Halt RPi</button>
        </div> -->
	<div style="margin-left: 1em" class="navbarRightAlign">
            <button class="btn btn-secondary m-auto titleBarButton" onclick="onLLRestart(this);">Restart LL</button>
        </div>
        <!-- <div style="margin-left: 1em" class="navbarRightAlign">
            <label class="switch">
                <input type="checkbox titleBarButton" onclick="onPopupToggle(this);">
                <span class="slider round btn btn-secondary"></span>
            </label>
        </div> -->
        <div class="">
            <div class="master-only" style="text-align: right;">
                <input type="checkbox" id="autoAbortCbox" onclick="onAutoAbortChange(this);">
                Auto Abort
            </div>
            <div class="master-only" id="masterLock" hidden>
                <input type="checkbox" id="masterLockBox" onclick="onMasterLockClicked(this);">
                Master Locked
            </div>
            <div class="client-only">
                <button class="btn btn-secondary titleBarButton" id="masterRequest" onclick="onMasterRequestPressed(this);">Request Master</button>
            </div>
            
            <p id="versionLabel">v<span id="version">1.0.0</span></p>
        </div>
    </div>

    <ul class="nav nav-pills justify-content-center" id="myTab" role="tablist">
        <li class="nav-item master-only">
            <a class="nav-link tab-button" id="sequence-tab-button" data-toggle="tab" href="#sequence-tab"
                role="tab" aria-controls="sequence-tab" aria-selected="false">Sequence</a>
        </li>
        <li class="nav-item">
            <a class="nav-link tab-button active" id="control-tab-button" data-toggle="tab" href="#control-tab" role="tab"
                aria-controls="control-tab" aria-selected="true">P&ID</a>
        </li>
        <li class="nav-item master-only">
            <a class="nav-link tab-button" id="commands-tab-button" data-toggle="tab" href="#commands-tab" role="tab"
                aria-controls="commands-tab" aria-selected="false">Commands</a>
        </li>
        <li class="nav-item master-only">
            <a class="nav-link tab-button" id="calibration-tab-button" data-toggle="tab" href="#calibration-tab"
                role="tab" aria-controls="calibration-tab" aria-selected="false" hidden>Calibrate</a>
        </li>
    </ul>
    <hr>
    <div id="statusBars">
        <div id="webStatusBar" class="warning-bar">No Connection to Web Server</div>
        <div id="llserverStatusBar" class="warning-bar">No Connection to LLServer</div>
        <div id="dynamicStatusBars">
        </div>
    </div>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade master-only" id="sequence-tab" role="tabpanel" aria-labelledby="monitor-tab-button">
            <div class="container-fluid sequence-fluid">
                <div class="row header justify-content-start">
                    <div class="col col-2">
                        <select class="btn btn-secondary ecui-select" id="sequenceSelect"
                            onchange="onSequenceSelectChange(value);">
                        </select>
                    </div>
                    <div class="col col-2">
                        <button class="btn btn-secondary" id="toggleSequenceButton"
                            onclick="onToggleSequenceButton(this);">Start Sequence</button>
                    </div>
		    <div class="col col-2">
                        <button class="btn btn-secondary" id="toggleSequenceButton"
                            onclick="onExportLog(this);">Export</button>
                    </div>
                    <div class="col col-3 form-control-lg custom-control custom-checkbox row control-row" hidden>
                        <input type="checkbox" class="custom-control-input ckbx" id="debugSequenceCheck"
                            onclick="onDebugSequence(this);">
                        <label class="custom-control-label ckbx-label" for="debugSequenceCheck">Auto Sequence
                            Start</label>
                    </div>
                    <div class="col"></div>
                    <div class="col col-3">
                        <button class="btn btn-secondary float-right" id="sendPostSeqCommentButton" disabled="true"
                            onclick="onSendPostSequenceComment();">Send post-Seq Comment</button>
                    </div>
                </div>
                <div class="row content">
                    <div class="col">
                        <div id="sequenceChart"></div>
                    </div>
                    <div class="col col-4" id="checklistCol">
                        <div id="commentDiv">
                            <label for="commentTextbox">Comments:</label><br>
                            <textarea id="commentTextbox" class="textbox" rows="6">
Ox Pressure Tank: 150 bar
Fuel Pressure Tank: 195 bar
Ox Pressure Inlet: 40 bar
Fuel Pressure Inlet: 18 bar

Notes: Hotfire
                        </textarea>
                        </div>
                        <div class="accordion" id="checklist">

                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane fade show active" id="control-tab" role="tabpanel" aria-labelledby="control-tab-button">
            <div class="container-fluid pnid-container">
                <div class="row">
                    <select class="btn btn-secondary ecui-select" id="pnidSelect" onchange="onPnidSelectChange(value);">
                    </select>
                </div>
                <div id="pnid"></div>
            </div>

        </div>
        <div class="tab-pane fade master-only" id="calibration-tab" role="tabpanel" aria-labelledby="calibration-tab-button">
            <div id="calibration-container" class="container-fluid">
                <div class="servo-enable-container row control-row">
                    <div class="form-control-lg custom-control custom-checkbox col">
                        <input type="checkbox" class="custom-control-input ckbx manualEnableCheck"
                            id="manualEnableCheck1" onclick="onManualControlEnable(this);">
                        <label class="custom-control-label ckbx-label" for="manualEnableCheck1">Enable Manual
                            Control</label>
                    </div>
                    <div class="form-control-lg custom-control custom-checkbox col">
                        <input type="checkbox" class="custom-control-input ckbx servoEnableCheck" id="servoEnableCheck1"
                            onclick="onServoEnable(this);" disabled>
                        <label class="custom-control-label ckbx-label" for="servoEnableCheck1">Enable Servos</label>
                    </div>
                    <div class="col"></div>
                </div>

                <div class="row control-row">
                    <div class="col col-3 spinner">
                        <label class="input-label" for="fuelMainValveCal" style="width: 100%;">
                            <div class="container-fluid calLabel-container">
                                <div class="row">
                                    <div id="fuelMainValveMinLabel" class="col col-3 minLabel">1200</div>
                                    <div id="fuelMainValveLabel" class="col centerLabel">Fuel Main Valve</div>
                                    <div id="fuelMainValveMaxLabel" class="col col-3 maxLabel">2000</div>
                                </div>
                            </div>
                        </label>
                        <input id="fuelMainValveCal" class="manual-obj servo-enable-obj" type="number" value="1500"
                            data-decimals="0" min="800" max="2200" step="1" onchange="onServoSpinnerChange($(this));"
                            disabled />
                    </div>
                    <div class="col col-5">
                        <button class="btn btn-secondary cal-btn manual-obj servo-enable-obj" id="fuelMainValveMin"
                            onclick="onCalibrateMin($(this));" disabled>Set Close
                        </button>
                        <button class="btn btn-secondary cal-btn manual-obj servo-enable-obj" id="fuelMainValveMax"
                            onclick="onCalibrateMax($(this));" disabled>Set Open
                        </button>
                    </div>
                </div>

                <div class="row control-row">

                    <div class="col col-3 spinner">
                        <label class="input-label" for="oxMainValveCal">
                            <div class="container-fluid calLabel-container">
                                <div class="row">
                                    <div id="oxMainValveMinLabel" class="col col-3 minLabel">1200</div>
                                    <div id="oxMainValveLabel" class="col centerLabel">Oxidizer Main Valve</div>
                                    <div id="oxMainValveMaxLabel" class="col col-3 maxLabel">2000</div>
                                </div>
                            </div>
                        </label>
                        <input id="oxMainValveCal" class="manual-obj servo-enable-obj" type="number" value="1500"
                            data-decimals="0" min="800" max="2200" step="1" onchange="onServoSpinnerChange($(this));"
                            disabled />
                    </div>
                    <div class="col col-5">
                        <button class="btn btn-secondary cal-btn manual-obj servo-enable-obj" id="oxMainValveMin"
                            onclick="onCalibrateMin($(this));" disabled>Set Close
                        </button>
                        <button class="btn btn-secondary cal-btn manual-obj servo-enable-obj" id="oxMainValveMax"
                            onclick="onCalibrateMax($(this));" disabled>Set Open
                        </button>
                    </div>
                </div>

                <div class="row control-row">

                    <div class="col col-3 spinner">
                        <label class="input-label" for="oxSuperchargeValveCal">
                            <div class="container-fluid calLabel-container">
                                <div class="row">
                                    <div id="oxSuperchargeValveMinLabel" class="col col-3 minLabel">1200</div>
                                    <div id="oxSuperchargeValveLabel" class="col centerLabel">Oxidizer Supercharge Valve
                                    </div>
                                    <div id="oxSuperchargeValveMaxLabel" class="col col-3 maxLabel">2000</div>
                                </div>
                            </div>
                        </label>
                        <input id="oxSuperchargeValveCal" class="manual-obj servo-enable-obj" type="number" value="1500"
                            data-decimals="0" min="800" max="2200" step="1" onchange="onServoSpinnerChange($(this));"
                            disabled />
                    </div>
                    <div class="col col-5">
                        <button class="btn btn-secondary cal-btn manual-obj servo-enable-obj" id="oxSuperchargeValveMin"
                            onclick="onCalibrateMin($(this));" disabled>Set Close
                        </button>
                        <button class="btn btn-secondary cal-btn manual-obj servo-enable-obj" id="oxSuperchargeValveMax"
                            onclick="onCalibrateMax($(this));" disabled>Set Open
                        </button>
                    </div>
                </div>

            </div>

        </div>
        <div class="tab-pane fade master-only" id="commands-tab" role="tabpanel" aria-labelledby="commands-tab-button">
            <ul style="margin-top: 2em" class="nav nav-pills justify-content-center" id="myCommandTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link tab-button active" id="server-scripts-tab-button" data-toggle="tab" href="#server-scripts-tab"
                        role="tab" aria-controls="server-scripts-tab" aria-selected="true">Server Scripts</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link tab-button" id="can-command-tab-button" data-toggle="tab" href="#can-command-tab"
                        role="tab" aria-controls="can-command-tab" aria-selected="false">CAN Commands</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link tab-button" id="lora-command-tab-button" data-toggle="tab" href="#lora-command-tab" role="tab"
                        aria-controls="lora-command-tab" aria-selected="false">LORA Commands</a>
                </li>
            </ul>
            <div id="command-container" class="tab-content">
                <div class="tab-pane fade show active" id="server-scripts-tab" role="tabpanel" aria-labelledby="server-scripts-tab-button">
                    <div id="server-scripts-list" class="accordion" style="max-height: 500px; overflow: scroll; margin-bottom: 20px"></div>
                    Script outputs:
                    <div id="server-scripts-feedback" style="max-height: 500px; overflow: scroll; white-space: pre;"></div>
                </div>
                <div class="tab-pane fade" id="can-command-tab" role="tabpanel" aria-labelledby="can-command-tab-button">
                    <div class="form-outline">
                        <input type="search" id="commandSearch" style="height: auto !important;" class="form-control" placeholder="Search for Command" aria-label="Search" oninput="updateCommandSearch('can', this)"/>
                    </div>
                    <div id="command-list" class="accordion">
                    </div>
                </div>
                <div class="tab-pane fade" id="lora-command-tab" role="tabpanel" aria-labelledby="lora-command-tab-button">
                    <div class="form-outline">
                        <input type="search" id="commandSearch" style="height: auto !important;" class="form-control" placeholder="Search for Command" aria-label="Search" oninput="updateCommandSearch('lora', this)"/>
                    </div>
                    <div id="command-list-lora" class="accordion">
                    </div>
                </div>
            </div>

        </div>

    </div>

    <!-- Modal -->
    <div class="modal fade" id="outputAssuranceModal" tabindex="-1" role="dialog"
        aria-labelledby="outputAssuranceModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="outputAssuranceModalHeader">Are you sure you want activate <span
                            id="modal-output-name"></span>?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <!--                  <div class="modal-body">-->
                <!--                    ...-->
                <!--                  </div>-->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" style="margin-top: 0;" data-dismiss="modal"
                        onclick="onModalAccept();">Activate</button>
                    <button type="button" class="btn btn-dark" data-dismiss="modal"
                        onclick="onModalReject();">Cancel</button>
                </div>
            </div>
        </div>
    </div>


    <script src="/socket.io/socket.io.js"></script>
    <script src="lib/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
        crossorigin="anonymous"></script>
    <script src="lib/jquery-ui.js" integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30="
        crossorigin="anonymous"></script>

    <script>
        $("#version").load("version.txt", function () {

        });
    </script>

    <script src="lib/bootstrap-input-spinner.js"></script>

    <!-- Pnid -->
    <script src="pnid_houbolt/client/js/common.js"></script>
    <script src="theming/js/themeSwitcher.js"></script>
    <script src="pnid_houbolt/client/js/logManager.js"></script>
    <script src="pnid_houbolt/client/js/changeValues.js"></script>
    <script src="pnid_houbolt/client/js/popupManager.js"></script>
    <script src="pnid_houbolt/client/js/slider.js"></script>
    <script src="pnid_houbolt/client/js/inputs.js"></script>
    <script src="pnid_houbolt/client/js/pnid.js"></script>

    <script src="/js/GUIControls.js"></script>
    <script src="js/SequenceChart.js"></script>
    <script src="js/SensorChart.js"></script>
    <script src="js/DataLogger.js"></script>
    <script src="./js/ClientSocket.js"></script>
    <script src="js/ServerScripts.js"></script>
    <script src="lib/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="lib/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

   

    <script src="js/PnidLoader.js"></script>
    <script src="js/WebECUI.js"></script>
</body>

</html>
